<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ColdTreasure | News</title>

  <!-- 全站样式 -->
  <link rel="stylesheet" href="/assets/css/style.css?v=20" />

  <!-- News 页专属布局（精校版：空气层阴影 + 高级间距） -->
  <style>
    :root{
      --ct-w: 1240px;
      --ct-pad: 26px;

      /* 更像 Kith：发丝线 */
      --ct-line: rgba(18,18,18,.10);
      --ct-muted: rgba(18,18,18,.62);

      --ct-radius: 18px;

      /* Kith-ish 空气层阴影（基础 + hover） */
      --ct-shadow-0:
        0 1px 2px rgba(0,0,0,.03),
        0 8px 22px rgba(0,0,0,.04);
      --ct-shadow-1:
        0 2px 6px rgba(0,0,0,.05),
        0 14px 34px rgba(0,0,0,.06);
    }

    /* 页面容器（对齐首页留白） */
    main.page{
      max-width: var(--ct-w);
      margin: 22px auto 0;
      padding: 0 var(--ct-pad);
    }

    /* Page head（编辑部信息条 + 分割线） */
    .page-head{
      margin: 18px 0 22px;
    }
    .page-head__top{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
    }
    .page-title{
      margin:0;
      font-size: 38px;
      letter-spacing: -0.02em;
    }
    .page-head__right{
      display:flex;
      align-items:baseline;
      gap:10px;
      color: var(--ct-muted);
      font-size:13px;
      letter-spacing: .06em;
      white-space:nowrap;
    }
    .page-kicker{
      font-weight:600;
      text-transform:uppercase;
    }
    .page-dot{ opacity:.5; }
    .page-status{ opacity:.85; }

    .page-rule{
      margin-top:14px;
      height:1px;
      background: var(--ct-line);
      opacity:.9;
    }

    /* 单列列表：高级呼吸感 */
    .news-list{
      display:flex;
      flex-direction:column;

      /* ✅ 关键：从 18 → 42（杂志/展陈节奏） */
      gap: 42px;

      margin: 22px 0 0;
      padding: 0;
    }

    /* 单条资讯：左图右文（装裱感，不像 UI 卡片） */
    .news-item{
      display:flex;
      gap: 0; /* ✅ 图贴边更高级，文字呼吸交给 padding */

      align-items: stretch;
      border: 1px solid var(--ct-line);
      border-radius: var(--ct-radius);
      background:#fff;
      overflow:hidden;

      /* ✅ 基础就有空气层 */
      box-shadow: var(--ct-shadow-0);

      transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease;
    }
    .news-item:hover{
      transform: translateY(-2px);
      box-shadow: var(--ct-shadow-1);
      border-color: rgba(18,18,18,.14);
    }

    /* 左侧大图：大，但不挤爆留白 */
    .news-media{
      flex: 0 0 clamp(420px, 44vw, 560px);
      display:block;
      background: rgba(0,0,0,.02);
      overflow:hidden;
    }
    .news-media img{
      width:100%;
      height:100%;
      aspect-ratio: 3 / 2;
      object-fit: cover;
      display:block;

      transform: scale(1);
      transition: transform .32s ease;
    }
    .news-item:hover .news-media img{
      transform: scale(1.02);
    }

    /* 右侧文字：装裱感 */
    .news-body{
      flex:1;
      min-width:0;
      padding: 22px 22px 22px 26px; /* ✅ 精校：更高级的呼吸 */
      display:flex;
      flex-direction:column;
      justify-content:center;
    }

    .news-meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      font-size:12px;
      color: var(--ct-muted);
      margin-bottom: 10px;
    }

    .pill{
      border:1px solid var(--ct-line);
      border-radius:999px;
      padding: 4px 10px;
      background: rgba(0,0,0,.012);
    }

    .news-title{
      margin:0 0 10px;
      font-size: 22px;
      line-height: 1.18;
      letter-spacing: -0.01em;
      font-weight: 800;
    }
    .news-title a{
      color: inherit;
      text-decoration:none;
    }

    .news-summary{
      margin:0;
      font-size:14px;
      line-height: 1.65;
      color: rgba(18,18,18,.88);
      opacity:.86;

      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;

      max-width: 68ch;
    }

    .empty, .error{
      padding: 14px 16px;
      border:1px solid var(--ct-line);
      border-radius: var(--ct-radius);
      color: var(--ct-muted);
      background:#fff;
      box-shadow: var(--ct-shadow-0);
    }
    .error{
      border-color:#ffd0d0;
      background:#fff5f5;
      color:#7a2b2b;
    }

    /* 移动端：页头改上下、卡片改上下 */
    @media (max-width: 860px){
      main.page{ padding: 0 16px; }

      .page-head__top{
        align-items:flex-start;
        flex-direction:column;
        gap:10px;
      }
      .page-title{ font-size: 34px; }

      .news-list{ gap: 26px; }

      .news-item{ flex-direction:column; }
      .news-media{ flex: 0 0 auto; width:100%; }
      .news-media img{ aspect-ratio: 16 / 10; }

      .news-body{ padding: 16px 16px 18px; }
      .news-title{ font-size: 20px; }
    }
  </style>
</head>

<body>
  <!-- Header 模块 -->
  <div data-include="/modules/header/header.html"></div>

  <main class="page">
    <header class="page-head">
      <div class="page-head__top">
        <h1 class="page-title">News</h1>
        <div class="page-head__right">
          <span class="page-kicker">Daily drops</span>
          <span class="page-dot" aria-hidden="true">•</span>
          <span class="page-status" id="pageStatus">Loading…</span>
        </div>
      </div>
      <div class="page-rule" aria-hidden="true"></div>
    </header>

    <div id="app" class="empty">Loading…</div>

    <!-- Footer 模块 -->
    <div data-include="/modules/footer/footer.html"></div>
  </main>

  <!-- include：建议先加载（先注入 header/footer，再执行页面脚本更稳） -->
  <script src="/assets/js/include.v3.js"></script>

  <script>
    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    async function loadPosts(){
      const res = await fetch(`/assets/data/posts.json?v=${Date.now()}`, { cache:"no-store" });
      if(!res.ok) throw new Error(`Failed to load /assets/data/posts.json (${res.status})`);
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    }

    function renderItem(post){
      const id = post.id || "";
      const title = post.title || post.name || id || "Untitled";
      const summary = post.summary || post.desc || "";
      const date = post.date || post.release_date || "";
      const brand = Array.isArray(post.brand) ? post.brand.join(" / ") : (post.brand || "");
      const hero = post.hero || post.cover || post.image || "";

      const brandHtml = brand ? `<span class="pill">${escapeHtml(brand)}</span>` : "";
      const dateHtml  = date  ? `<span class="date">${escapeHtml(date)}</span>` : "";

      const href = `/post/?id=${encodeURIComponent(id)}`;

      return `
        <article class="news-item">
          <a class="news-media" href="${href}" aria-label="${escapeHtml(title)}">
            ${hero ? `<img src="${escapeHtml(hero)}" alt="${escapeHtml(title)}" loading="lazy">` : ``}
          </a>

          <div class="news-body">
            <div class="news-meta">${brandHtml}${dateHtml}</div>
            <h2 class="news-title"><a href="${href}">${escapeHtml(title)}</a></h2>
            ${summary ? `<p class="news-summary">${escapeHtml(summary)}</p>` : ``}
          </div>
        </article>
      `;
    }

    (async function main(){
      const app = document.getElementById("app");
      const statusEl = document.getElementById("pageStatus");

      try{
        const list = await loadPosts();
        if(!list.length){
          if (statusEl) statusEl.textContent = "0 posts";
          app.className = "empty";
          app.textContent = "No posts yet.";
          return;
        }

        // date 倒序
        const sorted = [...list].sort((a,b)=>{
          const da = (a.date || "").toString();
          const db = (b.date || "").toString();
          return db.localeCompare(da);
        });

        if (statusEl) statusEl.textContent = `${sorted.length} posts`;

        app.className = "";
        app.innerHTML = `<section class="news-list">${sorted.map(renderItem).join("")}</section>`;
      }catch(err){
        if (statusEl) statusEl.textContent = "Error";
        app.className = "error";
        app.innerHTML = `<b>Load failed</b><div style="margin-top:8px;">${escapeHtml(err.message || err)}</div>`;
      }
    })();
  </script>
</body>
</html>
