<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ColdTreasure</title>
  <link rel="stylesheet" href="/assets/css/style.css?v=2002" />
</head>

<body class="is-home">

  <!-- 顶部导航：仅文字（左上角品牌可点击，但不再依赖任何 hover 浮层） -->
  <header class="topbar">
    <a class="brand-lockup" href="/" aria-label="ColdTreasure Home">
      <div class="brand-text">
        <div class="brand-name">COLD TREASURE</div>
        <div class="brand-slogan">Archive Is Not For Resale</div>
      </div>
    </a>

    <nav class="nav" aria-label="Primary">
      <a class="nav-link is-active" href="/news/">NEWS</a>
      <a class="nav-link" href="/record/">RECORD</a>
      <a class="nav-link" href="/archive/">ARCHIVE</a>
    </nav>
  </header>

  <main class="page">

    <!-- 主视觉：左轮播（大图）右入口（独立列表） -->
    <section class="home-hero" aria-label="Featured and Portals">
      <div class="hero-grid">

        <section class="carousel" aria-label="Featured Carousel">
          <!-- 轮播可视区（图片层） -->
          <div class="carousel-stage">
            <div class="carousel-viewport" id="carouselViewport"></div>

            <!-- 控件：全部进入图片区域内部（后续用 CSS 绝对定位实现：左右贴边、底部居中） -->
            <div class="carousel-ui" aria-label="Carousel controls">
              <button class="btn btn-ghost carousel-arrow is-prev" id="carouselPrev" type="button" aria-label="Previous">←</button>

              <div class="carousel-dots" id="carouselDots" aria-label="Carousel pagination"></div>

              <button class="btn btn-ghost carousel-arrow is-next" id="carouselNext" type="button" aria-label="Next">→</button>
            </div>
          </div>
        </section>

        <!-- 右侧入口：新增英文摘要（克制信息层） -->
        <aside class="portal" aria-label="Portals">
          <a class="portal-item" href="/news/">
            <span class="portal-cn">快讯</span>
            <span class="portal-en">NEWS</span>
            <span class="portal-desc">Real-time sneaker updates</span>
          </a>

          <a class="portal-item" href="/record/">
            <span class="portal-cn">记录层</span>
            <span class="portal-en">RECORD</span>
            <span class="portal-desc">Release logs &amp; market notes</span>
          </a>

          <a class="portal-item" href="/archive/">
            <span class="portal-cn">档案馆</span>
            <span class="portal-en">ARCHIVE</span>
            <span class="portal-desc">Curated historical catalogue</span>
          </a>

          <a class="portal-item" href="/guide/">
            <span class="portal-cn">实用指南</span>
            <span class="portal-en">GUIDE</span>
            <span class="portal-desc">Practical buying &amp; care guides</span>
          </a>

          <a class="portal-item" href="/feature/">
            <span class="portal-cn">专题</span>
            <span class="portal-en">FEATURE</span>
            <span class="portal-desc">In-depth stories &amp; editorial picks</span>
          </a>
        </aside>

      </div>
    </section>

    <!-- News 区：三列，图上文下 -->
    <section class="home-news" aria-label="Latest News">
      <div class="section-head">
        <h2 class="section-title">NEWS</h2>
        <a class="section-link" href="/news/">查看全部资讯 →</a>
      </div>

      <div class="news-grid" id="homeNewsGrid"></div>

      <div class="view-all">
        <a class="btn btn-outline" href="/news/">查看全部资讯</a>
      </div>
    </section>

  </main>

  <footer class="footer">
    © COLD TREASURE — Archive is not for resale.
  </footer>

  <!-- 首页数据渲染：读取 posts.json -->
  <script>
    (function () {
      const POSTS_URL = "/assets/data/posts.json";

      const viewport = document.getElementById("carouselViewport");
      const dots = document.getElementById("carouselDots");
      const btnPrev = document.getElementById("carouselPrev");
      const btnNext = document.getElementById("carouselNext");
      const newsGrid = document.getElementById("homeNewsGrid");

      if (!viewport || !dots || !btnPrev || !btnNext || !newsGrid) return;

      const safeText = (s) => (s ?? "").toString();
      const fmtDate = (d) => safeText(d);

      const cardHTML = (p) => {
        const href = "/news/" + safeText(p.id) + "/";
        const title = safeText(p.title);
        const date = fmtDate(p.date);
        const brand = Array.isArray(p.brand) ? p.brand.join(", ") : safeText(p.brand || "");
        const img = safeText(p.hero || "");
        return `
          <article class="news-card">
            <a class="card-link" href="${href}">
              <div class="card-media">
                <img src="${img}" alt="${title}">
              </div>
              <div class="card-body">
                <div class="card-meta">${date}${brand ? " · " + brand : ""}</div>
                <h3 class="card-title">${title}</h3>
              </div>
            </a>
          </article>
        `;
      };

      const slideHTML = (p) => {
        const href = "/news/" + safeText(p.id) + "/";
        const title = safeText(p.title);
        const date = fmtDate(p.date);
        const brand = Array.isArray(p.brand) ? p.brand.join(", ") : safeText(p.brand || "");
        const img = safeText(p.hero || "");
        return `
          <div class="slide">
            <a class="slide-media" href="${href}">
              <img src="${img}" alt="${title}">
            </a>
            <div class="slide-text">
              <div class="slide-meta">${date}${brand ? " · " + brand : ""}</div>
              <a class="slide-title" href="${href}">${title}</a>
            </div>
          </div>
        `;
      };

      fetch(POSTS_URL, { cache: "no-store" })
        .then(r => r.json())
        .then(posts => {
          if (!Array.isArray(posts) || posts.length === 0) return;

          const slides = posts.slice(0, 3);
          viewport.innerHTML = slides.map(slideHTML).join("");
          dots.innerHTML = slides.map((_, i) =>
            `<button class="dot" type="button" aria-label="Go to slide ${i + 1}" data-i="${i}"></button>`
          ).join("");

          const latest = posts.slice(0, 6);
          newsGrid.innerHTML = latest.map(cardHTML).join("");

          let index = 0;
          const slideEls = Array.from(viewport.querySelectorAll(".slide"));
          const dotEls = Array.from(dots.querySelectorAll(".dot"));

          const render = () => {
            slideEls.forEach((el, i) => el.classList.toggle("is-active", i === index));
            dotEls.forEach((el, i) => el.classList.toggle("is-active", i === index));
          };

          const go = (i) => {
            index = (i + slideEls.length) % slideEls.length;
            render();
          };

          btnPrev.addEventListener("click", () => go(index - 1));
          btnNext.addEventListener("click", () => go(index + 1));
          dotEls.forEach(el => el.addEventListener("click", () => go(parseInt(el.dataset.i, 10) || 0)));

          render();
        })
        .catch(() => {});
    })();
  </script>

</body>
</html>
