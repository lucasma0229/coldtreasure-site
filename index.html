<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>COLD TREASURE</title>
  <style>
    :root{
      --w: 1180px;
      --bg:#fff;
      --text:#111;
      --muted:#6f6f6f;
      --line:#ececec;
      --card:#fff;
      --shadow: 0 12px 34px rgba(0,0,0,.08);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans SC", Arial;
      background:var(--bg);
      color:var(--text);
    }

    /* Top bar */
    header{
      border-bottom:1px solid var(--line);
      padding:14px 18px;
      position:sticky; top:0;
      background: rgba(255,255,255,.9);
      backdrop-filter: blur(10px);
      z-index:10;
    }
    header .wrap{
      max-width:var(--w);
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      text-decoration:none; color:var(--text);
    }
    .brand img{ width:26px; height:26px; object-fit:contain; }
    .brand span{
      font-weight:900;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:13px;
    }
    nav{ display:flex; gap:18px; }
    nav a{ font-weight:650; color:var(--text); opacity:.82; text-decoration:none; }
    nav a:hover{ opacity:1; }

    main{
      max-width:var(--w);
      margin: 20px auto 72px;
      padding: 0 18px;
    }

    /* HERO LAYOUT */
    .top{
      display:grid;
      grid-template-columns: 1.4fr .9fr;
      gap:18px;
      align-items:start;
    }

    .featured{
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      background:var(--card);
      box-shadow: var(--shadow);
    }
    .featured .media{
      aspect-ratio: 16 / 9;
      background:#f6f6f6;
      overflow:hidden;
    }
    .featured .media img{
      width:100%; height:100%; object-fit:cover; display:block;
      transform: scale(1.01);
    }
    .featured .body{
      padding: 16px 16px 18px;
    }
    .kicker{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color:var(--muted); font-size:12px; margin-bottom:10px;
    }
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding: 4px 10px;
      background:#fff;
    }
    .featured h1{
      margin:0 0 10px;
      font-size: 26px;
      line-height:1.25;
      letter-spacing:-.01em;
    }
    .featured h1 a{ color:var(--text); text-decoration:none; }
    .featured p{
      margin:0;
      color:#222;
      font-size:14px;
      line-height:1.7;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    /* RIGHT ENTRANCES */
    .side{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .entry{
      display:grid;
      grid-template-columns: 110px 1fr;
      gap:12px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      background:#fff;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .entry:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 26px rgba(0,0,0,.06);
      border-color: rgba(0,0,0,.08);
    }
    .entry .thumb{
      width:110px;
      background:#f6f6f6;
      aspect-ratio: 1 / 1;
      overflow:hidden;
    }
    .entry .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .entry .body{
      padding: 10px 12px 10px 0;
      min-width:0;
    }
    .entry .meta{
      display:flex; gap:8px; flex-wrap:wrap;
      color:var(--muted); font-size:12px; margin-bottom:6px;
    }
    .entry .title{
      margin:0;
      font-weight:850;
      font-size:14px;
      line-height:1.35;
      letter-spacing:-.01em;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .entry a{ color:var(--text); text-decoration:none; }

    /* SECTION: LATEST */
    .section{
      margin-top: 22px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }
    .section h2{
      margin:0;
      font-size:18px;
      letter-spacing:.02em;
    }
    .section a{
      color:var(--muted);
      text-decoration:none;
      font-weight:650;
    }
    .section a:hover{ color:var(--text); }

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
    }
    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      background:#fff;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0,0,0,.06);
      border-color: rgba(0,0,0,.08);
    }
    .card .media{
      aspect-ratio: 16 / 10;
      background:#f6f6f6;
      overflow:hidden;
    }
    .card .media img{ width:100%; height:100%; object-fit:cover; display:block; }
    .card .body{ padding: 12px 12px 14px; }
    .card .meta{ color:var(--muted); font-size:12px; display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .card .title{ margin:0; font-weight:900; font-size:15px; line-height:1.35; }
    .card .title a{ color:var(--text); text-decoration:none; }
    .card .excerpt{
      margin:8px 0 0;
      color:#222;
      font-size:13px;
      line-height:1.65;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    .empty, .error{
      margin-top: 14px;
      padding: 14px 16px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      color:var(--muted);
      background:#fff;
    }
    .error{
      border-color:#ffd0d0;
      background:#fff5f5;
      color:#7a2b2b;
    }

    footer{
      margin-top: 34px;
      padding-top: 18px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
    }

    @media (max-width: 980px){
      .top{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 640px){
      .grid{ grid-template-columns: 1fr; }
      .featured h1{ font-size:22px; }
      nav{ gap:14px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <a class="brand" href="/">
        <img src="/assets/img/logo.png" alt="logo" onerror="this.style.display='none'">
        <span>COLD TREASURE</span>
      </a>
      <nav>
        <a href="/news/">News</a>
        <a href="/record/">Record</a>
        <a href="/archive/">Archive</a>
      </nav>
    </div>
  </header>

  <main>
    <div id="app" class="empty">Loading…</div>

    <footer>
      © COLD TREASURE — Archive is not for resale.
    </footer>
  </main>

  <script>
    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function normBrand(b){
      if (Array.isArray(b)) return b.join(" / ");
      return b || "";
    }

    function getDateStr(d){
      return (d || "").toString();
    }

    async function loadPosts(){
      // 绝对路径 + cache buster，避免 / 目录相对路径错误和缓存
      const res = await fetch(`/assets/data/posts.json?v=${Date.now()}`, { cache:"no-store" });
      if(!res.ok) throw new Error(`Failed to load /assets/data/posts.json (${res.status})`);
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    }

    function sortByDateDesc(list){
      return [...list].sort((a,b)=>{
        const da = getDateStr(a.date);
        const db = getDateStr(b.date);
        return db.localeCompare(da);
      });
    }

    function featuredBlock(p){
      const title = p.title || p.id || "Untitled";
      const hero = p.hero || p.image || p.cover || p.thumb || "";
      const brand = normBrand(p.brand);
      const date = getDateStr(p.date);
      const summary = p.summary || "";

      return `
        <section class="featured">
          <a href="/post/?id=${encodeURIComponent(p.id)}" aria-label="${escapeHtml(title)}">
            <div class="media">
              ${hero ? `<img src="${escapeHtml(hero)}" alt="${escapeHtml(title)}" loading="eager">` : ""}
            </div>
          </a>
          <div class="body">
            <div class="kicker">
              ${brand ? `<span class="pill">${escapeHtml(brand)}</span>` : ""}
              ${date ? `<span>${escapeHtml(date)}</span>` : ""}
            </div>
            <h1><a href="/post/?id=${encodeURIComponent(p.id)}">${escapeHtml(title)}</a></h1>
            ${summary ? `<p>${escapeHtml(summary)}</p>` : ""}
          </div>
        </section>
      `;
    }

    function entryBlock(p){
      const title = p.title || p.id || "Untitled";
      const hero = p.hero || p.image || p.cover || p.thumb || "";
      const brand = normBrand(p.brand);
      const date = getDateStr(p.date);

      return `
        <article class="entry">
          <a href="/post/?id=${encodeURIComponent(p.id)}" style="display:contents;">
            <div class="thumb">
              ${hero ? `<img src="${escapeHtml(hero)}" alt="${escapeHtml(title)}" loading="lazy">` : ""}
            </div>
            <div class="body">
              <div class="meta">
                ${brand ? `<span>${escapeHtml(brand)}</span>` : ""}
                ${date ? `<span>${escapeHtml(date)}</span>` : ""}
              </div>
              <h3 class="title">${escapeHtml(title)}</h3>
            </div>
          </a>
        </article>
      `;
    }

    function cardBlock(p){
      const title = p.title || p.id || "Untitled";
      const hero = p.hero || p.image || p.cover || p.thumb || "";
      const brand = normBrand(p.brand);
      const date = getDateStr(p.date);
      const excerpt = p.summary || "";

      return `
        <article class="card">
          <a href="/post/?id=${encodeURIComponent(p.id)}" aria-label="${escapeHtml(title)}">
            <div class="media">
              ${hero ? `<img src="${escapeHtml(hero)}" alt="${escapeHtml(title)}" loading="lazy">` : ""}
            </div>
          </a>
          <div class="body">
            <div class="meta">
              ${brand ? `<span class="pill">${escapeHtml(brand)}</span>` : ""}
              ${date ? `<span>${escapeHtml(date)}</span>` : ""}
            </div>
            <h3 class="title"><a href="/post/?id=${encodeURIComponent(p.id)}">${escapeHtml(title)}</a></h3>
            ${excerpt ? `<p class="excerpt">${escapeHtml(excerpt)}</p>` : ""}
          </div>
        </article>
      `;
    }

    (async function main(){
      const app = document.getElementById("app");
      try{
        const posts = sortByDateDesc(await loadPosts());
        if(!posts.length){
          app.className = "empty";
          app.textContent = "No posts yet.";
          return;
        }

        // Featured：默认取最新一条
        const featured = posts[0];

        // 右侧入口：取接下来最多 5 条（不足就用剩余）
        const side = posts.slice(1, 6);

        // 下方 grid：展示全部（或你也可以 slice(0, 6)）
        const grid = posts;

        app.className = "";
        app.innerHTML = `
          <div class="top">
            ${featuredBlock(featured)}
            <div class="side">
              ${side.map(entryBlock).join("")}
            </div>
          </div>

          <div class="section">
            <h2>Latest</h2>
            <a href="/news/">View all</a>
          </div>

          <div class="grid">
            ${grid.map(cardBlock).join("")}
          </div>
        `;
      }catch(err){
        app.className = "error";
        app.innerHTML = `
          <b>Homepage load failed</b>
          <div style="margin-top:8px;">${escapeHtml(err.message || err)}</div>
          <div style="margin-top:8px;color:#7a2b2b;">
            请确认：<code>/assets/data/posts.json</code> 存在且为 JSON 数组。
          </div>
        `;
      }
    })();
  </script>
</body>
</html>
