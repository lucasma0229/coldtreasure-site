<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ColdTreasure</title>
  <!-- 强制刷新用：你每次改样式就把 v= 后面的数字加大 -->
  <link rel="stylesheet" href="/assets/css/style.css?v=1000" />
</head>

<body class="is-home">

  <!-- 全站统一悬停（不位移，只淡入） -->
  <div class="brand-hover" aria-hidden="true">
    <div class="brand-hover-main">COLD TREASURE</div>
    <div class="brand-hover-sub">Archive Is Not For Resale</div>
  </div>

  <!-- 顶部导航（全站统一） -->
  <header class="topbar">
    <a class="brand-lockup" href="/" aria-label="ColdTreasure Home">
      <!-- 左上角品牌 Logo（你已放到 assets/img/brand/logo.png） -->
      <img class="brand-mark" src="/assets/img/brand/logo.png" alt="COLD TREASURE" />
      <div class="brand-text">
        <div class="brand-name">COLD TREASURE</div>
        <div class="brand-slogan">ARCHIVE IS NOT FOR RESALE</div>
      </div>
    </a>

    <nav class="nav" aria-label="Primary">
      <a class="is-active" href="/news/">NEWS</a>
      <a href="/record/">RECORD</a>
      <a href="/archive/">ARCHIVE</a>
    </nav>
  </header>

  <main class="page">

    <!-- ① 首页上半页：Logo 区 -->
    <section class="home-logo" aria-label="Brand">
      <div class="home-logo-inner">
        <!-- 用你这张横幅 Logo 作为首页 1 区最合适 -->
        <img
          class="home-wordmark-img"
          src="/assets/img/brand/logo.png"
          alt="ColdTreasure"
        />
      </div>
    </section>

    <!-- ②③ 首页下半页：6/4 主区 -->
    <section class="home-hero" aria-label="Featured and Portals">
      <div class="hero-grid">

        <!-- 左：轮播（图上文下，不压图；图片统一高度在 CSS 控制） -->
        <section class="carousel" aria-label="Featured Carousel">
          <div class="carousel-viewport" id="carouselViewport">
            <!-- JS 注入 -->
          </div>

          <div class="carousel-controls">
            <button class="btn btn-ghost" id="carouselPrev" type="button" aria-label="Previous">←</button>
            <div class="carousel-dots" id="carouselDots" aria-label="Carousel pagination"></div>
            <button class="btn btn-ghost" id="carouselNext" type="button" aria-label="Next">→</button>
          </div>
        </section>

        <!-- 右：五大入口（中文 + 英文同行，英文更小，跟在中文后面） -->
        <aside class="portal" aria-label="Portals">
          <a class="portal-item" href="/news/">
            <span class="portal-cn">快讯</span>
            <span class="portal-en">NEWS</span>
          </a>

          <a class="portal-item" href="/record/">
            <span class="portal-cn">记录层</span>
            <span class="portal-en">RECORD</span>
          </a>

          <a class="portal-item" href="/archive/">
            <span class="portal-cn">档案馆</span>
            <span class="portal-en">ARCHIVE</span>
          </a>

          <a class="portal-item" href="/guide/">
            <span class="portal-cn">实用指南</span>
            <span class="portal-en">GUIDE</span>
          </a>

          <a class="portal-item" href="/feature/">
            <span class="portal-cn">专题</span>
            <span class="portal-en">FEATURE</span>
          </a>
        </aside>

      </div>
    </section>

    <!-- ⑥ 随滚动出现的 News 层：三列，图上文下 -->
    <section class="home-news" aria-label="Latest News">
      <div class="section-head">
        <h2 class="section-title">NEWS</h2>
        <a class="section-link" href="/news/">查看全部资讯 →</a>
      </div>

      <div class="news-grid" id="homeNewsGrid">
        <!-- JS 注入 -->
      </div>

      <!-- ⑦ View All（保留） -->
      <div class="view-all">
        <a class="btn btn-outline" href="/news/">查看全部资讯</a>
      </div>
    </section>

  </main>

  <!-- ⑫ 全站统一 footer -->
  <footer class="footer">
    © COLD TREASURE — Archive is not for resale.
  </footer>

  <!-- 首页数据渲染：读取 posts.json -->
  <script>
    (function () {
      const POSTS_URL = "/assets/data/posts.json";

      const viewport = document.getElementById("carouselViewport");
      const dots = document.getElementById("carouselDots");
      const btnPrev = document.getElementById("carouselPrev");
      const btnNext = document.getElementById("carouselNext");
      const newsGrid = document.getElementById("homeNewsGrid");

      if (!viewport || !dots || !btnPrev || !btnNext || !newsGrid) return;

      const safeText = (s) => (s ?? "").toString();
      const fmtDate = (d) => safeText(d);

      const cardHTML = (p) => {
        const href = "/news/" + safeText(p.id) + "/";
        const title = safeText(p.title);
        const date = fmtDate(p.date);
        const brand = Array.isArray(p.brand) ? p.brand.join(", ") : safeText(p.brand || "");
        const img = safeText(p.hero || "");
        return `
          <article class="news-card">
            <a class="card-link" href="${href}">
              <div class="card-media">
                <img src="${img}" alt="${title}">
              </div>
              <div class="card-body">
                <div class="card-meta">${date}${brand ? " · " + brand : ""}</div>
                <h3 class="card-title">${title}</h3>
              </div>
            </a>
          </article>
        `;
      };

      const slideHTML = (p) => {
        const href = "/news/" + safeText(p.id) + "/";
        const title = safeText(p.title);
        const date = fmtDate(p.date);
        const brand = Array.isArray(p.brand) ? p.brand.join(", ") : safeText(p.brand || "");
        const img = safeText(p.hero || "");
        return `
          <div class="slide">
            <a class="slide-media" href="${href}">
              <img src="${img}" alt="${title}">
            </a>
            <div class="slide-text">
              <div class="slide-meta">${date}${brand ? " · " + brand : ""}</div>
              <a class="slide-title" href="${href}">${title}</a>
            </div>
          </div>
        `;
      };

      fetch(POSTS_URL, { cache: "no-store" })
        .then(r => r.json())
        .then(posts => {
          if (!Array.isArray(posts) || posts.length === 0) return;

          // 轮播：取前 3 条
          const slides = posts.slice(0, 3);
          viewport.innerHTML = slides.map(slideHTML).join("");
          dots.innerHTML = slides.map((_, i) =>
            `<button class="dot" type="button" aria-label="Go to slide ${i + 1}" data-i="${i}"></button>`
          ).join("");

          // 首页 News：取最近 6 条（保持三列密度）
          const latest = posts.slice(0, 6);
          newsGrid.innerHTML = latest.map(cardHTML).join("");

          // Carousel behavior
          let index = 0;
          const slideEls = Array.from(viewport.querySelectorAll(".slide"));
          const dotEls = Array.from(dots.querySelectorAll(".dot"));

          const render = () => {
            slideEls.forEach((el, i) => el.classList.toggle("is-active", i === index));
            dotEls.forEach((el, i) => el.classList.toggle("is-active", i === index));
          };

          const go = (i) => {
            index = (i + slideEls.length) % slideEls.length;
            render();
          };

          btnPrev.addEventListener("click", () => go(index - 1));
          btnNext.addEventListener("click", () => go(index + 1));
          dotEls.forEach(el => el.addEventListener("click", () => go(parseInt(el.dataset.i, 10) || 0)));

          render();
        })
        .catch(() => {});
    })();
  </script>

</body>
</html>
