<header class="topbar" data-topbar>
  <a class="brand-lockup" href="/" aria-label="ColdTreasure Home">
    <div class="brand-text">
      <div class="brand-name">COLD TREASURE</div>
      <div class="brand-slogan">ARCHIVE IS NOT FOR RESALE</div>
    </div>
  </a>

  <nav class="nav" aria-label="Primary">
    <a href="/news/">News</a>
    <a href="/record/">Record</a>
    <a href="/archive/">Archive</a>
  </nav>
</header>

<script>
/**
 * ColdTreasure Header (Kith-like)
 * - Home at top: overlay (transparent + white)
 * - Home scrolled: solid (white bg + black)
 * - Other pages: solid
 *
 * Works when injected via include.js because it runs immediately after insertion.
 */
(function(){
  // 防止 include 重复插入导致重复绑定
  if (window.__CT_HEADER_INITED__) return;
  window.__CT_HEADER_INITED__ = true;

  const path = (location.pathname || "/").toLowerCase();
  const topbar = document.querySelector("[data-topbar]");
  if (!topbar) return;

  // ======== Nav active ========
  document.querySelectorAll(".nav a").forEach(a => {
    const href = (a.getAttribute("href") || "").toLowerCase();
    const isNews = (href === "/news/") && (path.startsWith("/news") || path.startsWith("/post"));
    const isSection = (href !== "/news/") && href !== "/" && path.startsWith(href);
    if (isNews || isSection) a.classList.add("is-active");
  });

  // ======== Home detection ========
  const isHome =
    (String(window.CT_PAGE || "").toLowerCase() === "home") ||
    document.body.classList.contains("page-home") ||
    path === "/" || path === "/index.html";

  function syncNavH(){
    // 用真实高度驱动 --navH（layout.css 用它做 padding-top/overlay）
    const h = Math.round(topbar.getBoundingClientRect().height || 72);
    document.documentElement.style.setProperty("--navH", h + "px");
  }

  function applyState(){
    syncNavH();
    const y = window.scrollY || document.documentElement.scrollTop || 0;

    if (!isHome){
      document.documentElement.classList.remove("ct-nav--overlay");
      document.documentElement.classList.add("ct-nav--solid");
      return;
    }

    if (y <= 8){
      document.documentElement.classList.add("ct-nav--overlay");
      document.documentElement.classList.remove("ct-nav--solid");
    }else{
      document.documentElement.classList.remove("ct-nav--overlay");
      document.documentElement.classList.add("ct-nav--solid");
    }
  }

  // 初始执行（用 rAF 确保布局尺寸已稳定）
  requestAnimationFrame(applyState);

  // 绑定一次即可
  window.addEventListener("scroll", applyState, { passive:true });
  window.addEventListener("resize", applyState);
})();
</script>
