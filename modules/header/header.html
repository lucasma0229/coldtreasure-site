<header class="topbar" data-topbar>
  <a class="brand-lockup" href="/" aria-label="ColdTreasure Home">
    <div class="brand-text">
      <div class="brand-name">COLD TREASURE</div>
      <div class="brand-slogan">ARCHIVE IS NOT FOR RESALE</div>
    </div>
  </a>

  <nav class="nav" aria-label="Primary">
    <a href="/news/">News</a>
    <a href="/record/">Record</a>
    <a href="/archive/">Archive</a>
  </nav>
</header>

<script>
(function(){
  const path = (location.pathname || "/").toLowerCase();

  // ========== Nav active ==========
  document.querySelectorAll(".nav a").forEach(a => {
    const href = (a.getAttribute("href") || "").toLowerCase();
    const isNews = (href === "/news/") && (path.startsWith("/news") || path.startsWith("/post"));
    const isSection = (href !== "/news/") && href !== "/" && path.startsWith(href);
    if (isNews || isSection) a.classList.add("is-active");
  });

  // ========== Kith-style Header state ==========
  const topbar = document.querySelector("[data-topbar]");
  if (!topbar) return;

  const isHome =
    (String(window.CT_PAGE || "").toLowerCase() === "home") ||
    document.body.classList.contains("page-home") ||
    path === "/" || path === "/index.html";

  function syncNavH(){
    const h = Math.round(topbar.getBoundingClientRect().height || 72);
    document.documentElement.style.setProperty("--navH", h + "px");
  }

  function applyState() {
    syncNavH();

    const y = window.scrollY || document.documentElement.scrollTop || 0;

    if (!isHome) {
      document.documentElement.classList.remove("ct-nav--overlay");
      document.documentElement.classList.add("ct-nav--solid");
      return;
    }

    // 首页：顶部 overlay（白字，白底消失）；下滑一点点就 solid（白底出现）
    if (y <= 8) {
      document.documentElement.classList.add("ct-nav--overlay");
      document.documentElement.classList.remove("ct-nav--solid");
    } else {
      document.documentElement.classList.remove("ct-nav--overlay");
      document.documentElement.classList.add("ct-nav--solid");
    }
  }

  applyState();
  window.addEventListener("scroll", applyState, { passive: true });
  window.addEventListener("resize", applyState);
})();
</script>
